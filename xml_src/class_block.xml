<?xml version="1.0"?>

<Protocol name="DC_Block"
          prefix="DC_Block_"
          api="1"
          version="1.0"
          supportSpecialFloat="false"
          supportInt64="false"
          supportFloat64="false"
          endian="big"
          pointer="DC_Packet_t"
          >

  <Include name="drone_can_protocol_glue.h" comment="Protocol glue files"/>

  <Documentation name="Block Data" paragraph="1" comment="DroneCAN block data transfer"/>

  <Enum name="DroneCAN_BlockDataEndpoints" prefix="DC_BLOCK_ENDPOINT_" comment="Block data endpoints" description="When transmitting block data, the endpoint is used to determine the source or destination of the data">
    <Value name="MULTI_FRAME" comment="Multi-frame message transfer" value="0x00"/>

    <Value name="BOOTLOADER" comment="Bootloader data" value="0x10"/>

    <Value name="INVALID" comment="Invalid enpoint. Do not define endpoint ID values higher than this" value="0xFF"/>
  </Enum>

  <Enum name="DroneCAN_BlockDataMessages" prefix="DC_PKT_BLOCK_" comment="Block data messages" description="Message identifies for block data transfer management">
    <Value name="DATA_0"  comment="Block data transfer, offset 0" value="0x00"/>
    <Value name="DATA_1"  comment="Block data transfer, offset 1"/>
    <Value name="DATA_2"  comment="Block data transfer, offset 2"/>
    <Value name="DATA_3"  comment="Block data transfer, offset 3"/>
    <Value name="DATA_4"  comment="Block data transfer, offset 4"/>
    <Value name="DATA_5"  comment="Block data transfer, offset 5"/>
    <Value name="DATA_6"  comment="Block data transfer, offset 6"/>
    <Value name="DATA_7"  comment="Block data transfer, offset 7"/>
    <Value name="DATA_8"  comment="Block data transfer, offset 8"/>
    <Value name="DATA_9"  comment="Block data transfer, offset 9"/>
    <Value name="DATA_10" comment="Block data transfer, offset 10"/>
    <Value name="DATA_11" comment="Block data transfer, offset 11"/>
    <Value name="DATA_12" comment="Block data transfer, offset 12"/>
    <Value name="DATA_13" comment="Block data transfer, offset 13"/>
    <Value name="DATA_14" comment="Block data transfer, offset 14"/>
    <Value name="DATA_15" comment="Block data transfer, offset 15"/>
    <Value name="DATA_16" comment="Block data transfer, offset 16"/>
    <Value name="DATA_17" comment="Block data transfer, offset 17"/>
    <Value name="DATA_18" comment="Block data transfer, offset 18"/>
    <Value name="DATA_19" comment="Block data transfer, offset 19"/>
    <Value name="DATA_20" comment="Block data transfer, offset 20"/>
    <Value name="DATA_21" comment="Block data transfer, offset 21"/>
    <Value name="DATA_22" comment="Block data transfer, offset 22"/>
    <Value name="DATA_23" comment="Block data transfer, offset 23"/>
    <Value name="DATA_24" comment="Block data transfer, offset 24"/>
    <Value name="DATA_25" comment="Block data transfer, offset 25"/>
    <Value name="DATA_26" comment="Block data transfer, offset 26"/>
    <Value name="DATA_27" comment="Block data transfer, offset 27"/>
    <Value name="DATA_28" comment="Block data transfer, offset 28"/>
    <Value name="DATA_29" comment="Block data transfer, offset 29"/>
    <Value name="DATA_30" comment="Block data transfer, offset 30"/>
    <Value name="DATA_31" comment="Block data transfer, offset 31"/>
    <Value name="DATA_32" comment="Block data transfer, offset 32"/>
    <Value name="DATA_33" comment="Block data transfer, offset 33"/>
    <Value name="DATA_34" comment="Block data transfer, offset 34"/>
    <Value name="DATA_35" comment="Block data transfer, offset 35"/>
    <Value name="DATA_36" comment="Block data transfer, offset 36"/>
    <Value name="DATA_37" comment="Block data transfer, offset 37"/>
    <Value name="DATA_38" comment="Block data transfer, offset 38"/>
    <Value name="DATA_39" comment="Block data transfer, offset 39"/>
    <Value name="DATA_40" comment="Block data transfer, offset 40"/>
    <Value name="DATA_41" comment="Block data transfer, offset 41"/>
    <Value name="DATA_42" comment="Block data transfer, offset 42"/>
    <Value name="DATA_43" comment="Block data transfer, offset 43"/>
    <Value name="DATA_44" comment="Block data transfer, offset 44"/>
    <Value name="DATA_45" comment="Block data transfer, offset 45"/>
    <Value name="DATA_46" comment="Block data transfer, offset 46"/>
    <Value name="DATA_47" comment="Block data transfer, offset 47"/>
    <Value name="DATA_48" comment="Block data transfer, offset 48"/>
    <Value name="DATA_49" comment="Block data transfer, offset 49"/>
    <Value name="DATA_50" comment="Block data transfer, offset 50"/>
    <Value name="DATA_51" comment="Block data transfer, offset 51"/>
    <Value name="DATA_52" comment="Block data transfer, offset 52"/>
    <Value name="DATA_53" comment="Block data transfer, offset 53"/>
    <Value name="DATA_54" comment="Block data transfer, offset 54"/>
    <Value name="DATA_55" comment="Block data transfer, offset 55"/>
    <Value name="DATA_56" comment="Block data transfer, offset 56"/>
    <Value name="DATA_57" comment="Block data transfer, offset 57"/>
    <Value name="DATA_58" comment="Block data transfer, offset 58"/>
    <Value name="DATA_59" comment="Block data transfer, offset 59"/>
    <Value name="DATA_60" comment="Block data transfer, offset 60"/>
    <Value name="DATA_61" comment="Block data transfer, offset 61"/>
    <Value name="DATA_62" comment="Block data transfer, offset 62"/>
    <Value name="DATA_63" comment="Block data transfer, offset 63"/>

    <Value name="START" comment="Start block data transfer" value="0x50"/>

    <Value name="ENDPOINT_INFO" comment="Block data endpoint information" value="0x60"/>

  <!--
    <Value name="ENDPOINT_INFO" comment="Block data endpoint information" value="0x55"/>
    <Value name="ADDRESS" comment="Block transfer address" value="0x50"/>
    <Value name="ACK" comment="Block transfer Rx acknowledge" value="0x55"/>
    <Value name="CHECKSUM" comment="Block transfer checksum" value="0x60"/>
  -->

  </Enum>

  <Packet name="BlockDataEndpointInfo"
          ID="DC_PKT_ENDPOINT_INFO"
          file="dc_pkt_block">

    <Data name="endpoint" inMemoryType="unsigned8"/>
    <Data name="size" inMemoryType="unsigned32"/>

  </Packet>

  <Struct name="BlockEndpointInfo" file="dc_pkt_block">
    <Data name="datSize" inMemoryType="unsigned32" comment="Total data size (bytes)"/>
    <Data name="blockSize" inMemoryType="unsigned16" comment="Single block size (bytes)"/>
  </Struct>

  <Packet name="BlockEndpointInfo"
          ID="DC_PKT_ENDPOINT_INFO"
          file="dc_pkt_block"
          parameterInterface="true">
    <Data name="endpoint" inMemoryType="unsigned8"/>
    <Data name="info" struct="BlockEndpointInfo"/>
  </Packet>

  <Packet name="GetBlockEndpointInfo"
          ID="DC_PKT_ENDPOINT_INFO"
          file="dc_pkt_block"
          parameterInterface="true">
    <Data name="endpoint" inMemoryType="unsigned8"/>
  </Packet>

  <Packet name="BlockAddress"
          ID="DC_PKT_BLOCK_ADDRESS"
          file="dc_pkt_block"
          parameterInterface="true"
          structureInterface="true">
    <Data name="address" inMemoryType="unsigned32" comment="Block starting address"/>
    <Data name="endpoint" inMemoryType="unsigned8" comment="Block data endpoint"/>
  </Packet>

  <Packet name="BlockChecksum"
          ID="DC_PKT_BLOCK_CHECKSUM"
          file="dc_pkt_block"
          parameterInterface="true"
          structureInterface="true">
    <Data name="address" inMemoryType="unsigned32" comment="Block starting address"/>
    <Data name="endpoint" inMemoryType="unsigned8" comment="Block data endpoint"/>
    <Data name="checksum" inMemoryType="unsigned16" comment="Block checksum"/>
  </Packet>

  <Packet name="StartBlockTransfer"
          ID="DC_PKT_BLK_START"
          file="dc_pkt_block">

    <Data name="id"       inMemoryType="unsigned8" comment="Transfer ID"/>
    <Data name="endpoint" inMemoryType="unsigned8" comment="Transfer endpoint"/>
    <Data name="address"  inMemoryType="unsigned32" comment="Transfer address"/>
    <Data name="size"     inMemoryType="unsigned16" comment="Transfer size (bytes)"/>
  </Packet>

</Protocol>
